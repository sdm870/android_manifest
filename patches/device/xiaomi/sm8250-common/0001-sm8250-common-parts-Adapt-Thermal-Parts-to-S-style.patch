From 6162888741a0efd315a610f76388e8ede9990f62 Mon Sep 17 00:00:00 2001
From: TheScarastic <warabhishek@gmail.com>
Date: Wed, 6 Oct 2021 07:25:13 +0000
Subject: [PATCH] sm8250-common: parts: Adapt Thermal Parts to S style

Change-Id: Id69636b5356b7a56cb1b6ba74271905f6316e651
---
 parts/AndroidManifest.xml                     |  2 +-
 parts/res/layout/thermal_layout.xml           |  8 +--
 parts/res/layout/thermal_list_item.xml        |  4 +-
 parts/res/values/styles.xml                   | 63 -------------------
 .../settings/thermal/ThermalActivity.java     | 19 ++++--
 .../thermal/ThermalSettingsFragment.java      |  1 +
 6 files changed, 19 insertions(+), 78 deletions(-)
 delete mode 100644 parts/res/values/styles.xml

diff --git a/parts/AndroidManifest.xml b/parts/AndroidManifest.xml
index d511eb8..49f708d 100644
--- a/parts/AndroidManifest.xml
+++ b/parts/AndroidManifest.xml
@@ -94,7 +94,7 @@
         <activity
             android:name=".thermal.ThermalActivity"
             android:label="@string/thermal_title"
-            android:theme="@style/Theme.Main">
+            android:theme="@style/Theme.SubSettingsBase">
             <intent-filter>
                 <action android:name="com.android.settings.action.IA_SETTINGS" />
             </intent-filter>
diff --git a/parts/res/layout/thermal_layout.xml b/parts/res/layout/thermal_layout.xml
index a1ee98a..b400c8f 100644
--- a/parts/res/layout/thermal_layout.xml
+++ b/parts/res/layout/thermal_layout.xml
@@ -11,15 +11,11 @@
      See the License for the specific language governing permissions and
      limitations under the License.
 -->
-<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
+<RelativeLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
     android:layout_width="match_parent"
     android:layout_height="match_parent">
 
-    <FrameLayout
-        android:id="@+id/thermal_prefs"
-        android:layout_width="match_parent"
-        android:layout_height="match_parent" />
-
     <ListView
         android:id="@+id/thermal_list_view"
         android:layout_width="match_parent"
diff --git a/parts/res/layout/thermal_list_item.xml b/parts/res/layout/thermal_list_item.xml
index 169578f..b2f1abb 100644
--- a/parts/res/layout/thermal_list_item.xml
+++ b/parts/res/layout/thermal_list_item.xml
@@ -13,7 +13,7 @@
 -->
 <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
     android:layout_width="match_parent"
-    android:layout_height="wrap_content"
+    android:layout_height="match_parent"
     android:minHeight="?android:attr/listPreferredItemHeight"
     android:paddingBottom="8dp"
     android:paddingEnd="?android:attr/listPreferredItemPaddingEnd"
@@ -43,7 +43,7 @@
             android:ellipsize="marquee"
             android:singleLine="true"
             android:textAlignment="viewStart"
-            android:textAppearance="@style/TextAppearance.Medium"
+            android:textAppearance="@android:style/TextAppearance.Material.Medium"
             android:textColor="?android:attr/textColorPrimary" />
 
         <Spinner
diff --git a/parts/res/values/styles.xml b/parts/res/values/styles.xml
deleted file mode 100644
index 3f4b0c7..0000000
--- a/parts/res/values/styles.xml
+++ /dev/null
@@ -1,63 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
-     Copyright (C) 2015-2016 The CyanogenMod Project
-                   2017-2020 The LineageOS Project
-     Licensed under the Apache License, Version 2.0 (the "License");
-     you may not use this file except in compliance with the License.
-     You may obtain a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-     Unless required by applicable law or agreed to in writing, software
-     distributed under the License is distributed on an "AS IS" BASIS,
-     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-     See the License for the specific language governing permissions and
-     limitations under the License.
--->
-<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <style name="Theme.Main" parent="@android:style/Theme.DeviceDefault.Settings">
-        <item name="dialogPreferenceStyle">@style/Theme.Main.DialogPreferenceStyle</item>
-        <item name="preferenceCategoryStyle">@style/Theme.Main.PreferenceCategoryStyle</item>
-        <item name="preferenceFragmentStyle">@style/Theme.Main.PreferenceFragmentStyle</item>
-        <item name="preferenceStyle">@style/Theme.Main.PreferenceStyle</item>
-        <item name="preferenceTheme">@style/Theme.Main.PreferenceTheme</item>
-        <item name="switchPreferenceStyle">@style/Theme.Main.SwitchPreferenceStyle</item>
-    </style>
-
-    <style name="Theme.Main.DialogPreferenceStyle" parent="@style/Theme.Main.PreferenceStyle">
-    </style>
-
-    <style name="Theme.Main.PreferenceCategoryStyle" parent="@*android:style/Preference.DeviceDefault.Category">
-        <item name="allowDividerAbove">true</item>
-        <item name="allowDividerBelow">true</item>
-        <item name="android:layout">@layout/preference_category_material_settings</item>
-    </style>
-
-    <style name="Theme.Main.PreferenceFragmentStyle" parent="@*android:style/PreferenceFragment.Material">
-        <item name="allowDividerAfterLastItem">false</item>
-    </style>
-
-    <style name="Theme.Main.PreferenceStyle" parent="@*android:style/Preference.DeviceDefault">
-        <item name="allowDividerAbove">false</item>
-        <item name="allowDividerBelow">true</item>
-        <item name="singleLineTitle">false</item>
-        <item name="android:layout">@layout/preference_material_settings</item>
-    </style>
-
-    <style name="Theme.Main.PreferenceTheme">
-    </style>
-
-    <style name="Theme.Main.SwitchPreferenceStyle" parent="@style/Theme.Main.PreferenceStyle">
-        <item name="widgetLayout">@*android:layout/preference_widget_switch</item>
-    </style>
-
-    <style name="Theme.Main.SwitchBar" parent="@android:style/ThemeOverlay.Material.ActionBar">
-    </style>
-
-    <style name="Theme.Main.SwitchBar.Switch">
-        <item name="android:trackTint">@color/switchbar_switch_track_tint</item>
-        <item name="android:thumbTint">@color/switchbar_switch_thumb_tint</item>
-    </style>
-    <style name="TextAppearance.Medium" parent="@android:style/TextAppearance.Material.Medium" />
-</resources>
-
diff --git a/parts/src/org/lineageos/settings/thermal/ThermalActivity.java b/parts/src/org/lineageos/settings/thermal/ThermalActivity.java
index 333bd08..16df382 100644
--- a/parts/src/org/lineageos/settings/thermal/ThermalActivity.java
+++ b/parts/src/org/lineageos/settings/thermal/ThermalActivity.java
@@ -17,11 +17,12 @@
 package org.lineageos.settings.thermal;
 
 import android.os.Bundle;
-import android.preference.PreferenceActivity;
+import android.view.MenuItem;
 
-import org.lineageos.settings.utils.FileUtils;
+import com.android.settingslib.collapsingtoolbar.CollapsingToolbarBaseActivity;
+import com.android.settingslib.collapsingtoolbar.R;
 
-public class ThermalActivity extends PreferenceActivity {
+public class ThermalActivity extends CollapsingToolbarBaseActivity {
 
     private static final String TAG_THERMAL = "thermal";
     private static final String THERMAL_SCONFIG = "/sys/class/thermal/thermal_message/sconfig";
@@ -29,10 +30,16 @@ public class ThermalActivity extends PreferenceActivity {
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
+        getFragmentManager().beginTransaction().replace(R.id.content_frame,
+                new ThermalSettingsFragment(), TAG_THERMAL).commit();
+    }
 
-        if (FileUtils.fileExists(THERMAL_SCONFIG)) {
-            getFragmentManager().beginTransaction().replace(android.R.id.content,
-                    new ThermalSettingsFragment(), TAG_THERMAL).commit();
+    @Override
+    public boolean onOptionsItemSelected(MenuItem item) {
+        if (item.getItemId() == android.R.id.home) {
+            onBackPressed();
+            return true;
         }
+        return false;
     }
 }
diff --git a/parts/src/org/lineageos/settings/thermal/ThermalSettingsFragment.java b/parts/src/org/lineageos/settings/thermal/ThermalSettingsFragment.java
index 92527db..b96a578 100644
--- a/parts/src/org/lineageos/settings/thermal/ThermalSettingsFragment.java
+++ b/parts/src/org/lineageos/settings/thermal/ThermalSettingsFragment.java
@@ -103,6 +103,7 @@ public class ThermalSettingsFragment extends PreferenceFragment
     @Override
     public void onResume() {
         super.onResume();
+        getActivity().setTitle(getResources().getString(R.string.thermal_title));
         rebuild();
     }
 
-- 
2.25.1

